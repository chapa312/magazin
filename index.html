<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Просто вещи</title>
  <style>
    /* -- Общие стили -- */
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#fff; overflow-x:hidden }
    h1 { text-align:center; margin-bottom:40px; color:#333 }

    /* -- Сетка карточек -- */
    .products {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:20px;
      max-width:1200px;
      margin:0 auto;
    }

    .product {
      width:220px;
      background:#fff;
      border:1px solid #e0e0e0;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      cursor:pointer;
      transition:box-shadow .3s, transform .2s;
      text-decoration: none;
      color: inherit;
    }
    .product:hover {
      box-shadow:0 8px 20px rgba(0,0,0,0.1);
      transform:translateY(-4px);
    }
    .product img {
      width:100%;
      object-fit:cover;
      border-top-left-radius:12px;
      border-top-right-radius:12px;
    }

    .product-content {
      padding:15px;
      display:flex;
      flex-direction:column;
    }
    .product-content h3 {
      margin:0 0 8px;
      font-size:20px;
      color:#222;
    }
    .product-content .category {
      margin:0 0 12px;
      font-size:14px;
      color:#666;
    }
    .product-content .price {
      margin:0;
      font-size:16px;
      font-weight:bold;
      color:#000;
    }

    /* -- Кнопка «Корзина» -- */
    #cart-button {
      position:fixed; bottom:20px; right:20px;
      background:#fff; border:none; padding:12px 20px;
      font-size:16px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
      cursor:pointer;
    }
    #cart-button:hover { background:#f0f0f0 }

    /* -- Drawer-корзина (осталась без изменений) -- */
    #cart-drawer {
      position:fixed; top:0; right:-360px;
      width:360px; height:100vh; background:#fff;
      box-shadow:-4px 0 12px rgba(0,0,0,0.1);
      transition:right .3s ease; display:flex; flex-direction:column; z-index:1000;
    }
    #cart-drawer.open { right:0 }
    .drawer-header {
      padding:24px 20px; font-size:24px; font-weight:600;
      border-bottom:1px solid #e0e0e0; position:relative;
    }
    .drawer-header .close-btn {
      position:absolute; top:24px; right:20px;
      background:none; border:none; font-size:20px; cursor:pointer;
    }
    .drawer-content {
      flex-grow:1; overflow-y:auto; padding:0 20px;
    }
    .drawer-item {
      display:flex; align-items:center; padding:16px 0;
      border-bottom:1px solid #e0e0e0;
    }
    .drawer-item:last-child { border-bottom:none }
    .drawer-item img {
      width:40px; height:40px; object-fit:contain;
      object-position:top center; border-radius:4px;
      margin-right:12px; background:#f5f5f5;
    }
    .item-info .title {
      font-size:18px; font-weight:500; margin-bottom:4px; color:#222;
    }
    .item-info .price {
      font-size:14px; color:#666;
    }
    .item-controls {
      display:flex; align-items:center; margin-left:16px;
    }
    .item-controls button {
      width:28px; height:28px; background:#fafafa;
      border:1px solid #ccc; border-radius:4px; font-size:18px;
      line-height:0; cursor:pointer; margin:0 4px;
      transition:background .2s;
    }
    .item-controls button:hover { background:#f0f0f0 }
    .item-controls .qty {
      min-width:24px; text-align:center; font-size:16px; font-weight:500;
    }
    .item-controls .remove-btn {
      background:none; border:none; font-size:20px; color:#999;
      cursor:pointer; margin-left:8px;
    }
    .drawer-footer {
      padding:20px; border-top:1px solid #e0e0e0;
    }
    .drawer-footer .sum {
      font-size:20px; font-weight:600; text-align:right; margin-bottom:16px;
    }
    .drawer-footer .checkout-btn {
      width:100%; padding:14px 0; background:#000; color:#fff;
      border:none; border-radius:6px; font-size:16px; font-weight:600;
      text-transform:uppercase; cursor:pointer; transition:background .3s;
    }
    .drawer-footer .checkout-btn:hover { background:#333 }
  </style>
</head>
<body>
  <h1>Просто вещи</h1>

  <!-- 1) Контейнер под товары -->
  <div class="products" id="products"></div>

  <!-- 2) Кнопка «Корзина» -->
  <button id="cart-button" onclick="openDrawer()">Корзина (0)</button>

  <!-- 3) Drawer-корзина -->
  <div id="cart-drawer">
    <div class="drawer-header">
      Ваш заказ
      <button class="close-btn" onclick="closeDrawer()">✕</button>
    </div>
    <div class="drawer-content">
      <div id="drawer-list"></div>
    </div>
    <div class="drawer-footer">
      <div class="sum">Сумма: <span id="drawer-sum">0</span> ₽</div>
      <button class="checkout-btn" onclick="onCheckout()">Оформить заказ</button>
    </div>
  </div>

  <script>
    // === Cart из localStorage ===
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    // === Список товаров с category и url ===
    const products = [
      {
        id:       1,
        name:     'Кофта 1',
        category: 'Hoodie / Cotton',
        price:    2000,
        image:    'img/kofta1.jpeg',
        back:     'img/kofta1-back.jpeg',
        url:      'product1.html'
      },
      {
        id:       2,
        name:     'Кофта 2',
        category: 'Zip-Hoodie / Cotton',
        price:    2500,
        image:    'img/kofta2.jpeg',
        back:     'img/kofta2-back.jpeg',
        url:      'product2.html'
      },
      // ... при необходимости добавьте ещё товаров
    ];

    // === Telegram.WebApp fallback ===
    const tg = window.Telegram?.WebApp || null;
    if (tg) {
      tg.ready(); tg.expand();
      tg.MainButton.setText('Оформить заказ');
      tg.MainButton.hide();
      tg.MainButton.onClick(() =>
        tg.sendData(JSON.stringify({ action:'checkout', items:cart }))
      );
    }

    // === Инициализация ===
    window.addEventListener('DOMContentLoaded', () => {
      renderProducts();
      updateCartUI();
    });

    // === Рендерим карточки ===
    function renderProducts() {
      const container = document.getElementById('products');
      container.innerHTML = '';
      products.forEach(p => {
        // <a> чтобы весь блок был кликабелен
        const link = document.createElement('a');
        link.href = p.url;
        link.className = 'product';

        // картинка с hover-flip
        const img = document.createElement('img');
        img.src = p.image;
        img.alt = p.name;
        img.dataset.front = p.image;
        img.dataset.back  = p.back;
        img.onmouseenter = e => e.target.src = e.target.dataset.back;
        img.onmouseleave = e => e.target.src = e.target.dataset.front;
        link.append(img);

        // текстовый блок
        const info = document.createElement('div');
        info.className = 'product-content';
        info.innerHTML = `
          <h3>${p.name}</h3>
          <p class="category">${p.category}</p>
          <p class="price">Цена: ${p.price} ₽</p>
        `;
        link.append(info);

        container.append(link);
      });
    }

    // === Обновляем drawer и кнопку ===
    function updateCartUI() {
      const list  = document.getElementById('drawer-list');
      const sumEl = document.getElementById('drawer-sum');
      const btn   = document.getElementById('cart-button');
      list.innerHTML = '';
      let sum = 0;

      // сгруппировать по id
      const grouped = {};
      cart.forEach(item => {
        if (!grouped[item.id]) grouped[item.id] = { ...item, qty:0 };
        grouped[item.id].qty++;
      });

      Object.values(grouped).forEach(item => {
        sum += item.price * item.qty;
        const row = document.createElement('div');
        row.className = 'drawer-item';
        row.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div class="item-info">
            <div class="title">${item.name}</div>
            <div class="price">${item.price} ₽</div>
          </div>
          <div class="item-controls">
            <button onclick="changeQty(${item.id}, -1)">−</button>
            <span class="qty">${item.qty}</span>
            <button onclick="changeQty(${item.id}, +1)">+</button>
            <button class="remove-btn" onclick="removeItem(${item.id})">×</button>
          </div>`;
        list.append(row);
      });

      sumEl.textContent = sum;
      btn.textContent   = `Корзина (${cart.length})`;

      if (tg) {
        cart.length ? tg.MainButton.show() : tg.MainButton.hide();
      }
    }

    // === Изменение количества ===
    function changeQty(id, delta) {
      if (delta > 0) {
        const p = products.find(x => x.id === id);
        if (p) cart.push(p);
      } else {
        const idx = cart.findIndex(x => x.id === id);
        if (idx > -1) cart.splice(idx, 1);
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartUI();
    }

    // === Полное удаление позиции ===
    function removeItem(id) {
      cart = cart.filter(x => x.id !== id);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartUI();
    }

    // === Открыть/Закрыть drawer ===
    function openDrawer()  { document.getElementById('cart-drawer').classList.add('open'); }
    function closeDrawer() { document.getElementById('cart-drawer').classList.remove('open'); }

    // === Финальное оформление заказа ===
    function onCheckout() {
      if (tg) tg.sendData(JSON.stringify({ action:'checkout', items:cart }));
      else    alert('Ваш заказ: ' + JSON.stringify(cart));
    }
  </script>
</body>
</html>
